# 記帳功能快速開始

## 1️⃣ 數據庫設置（必須首先執行）

### 步驟 1: 登入 Supabase
1. 訪問 https://app.supabase.com
2. 使用你的 Google/GitHub 帳號登入
3. 選擇你的專案

### 步驟 2: 執行 SQL 初始化
1. 在左側菜單點擊 **SQL Editor**
2. 點擊 **New query**
3. 複製文件 `SQL_SETUP_EXPENSES.sql` 的全部內容
4. 粘貼到編輯器
5. 點擊 **RUN** 執行

✅ 如果看到「查詢成功」即為完成

## 2️⃣ 啟動應用

### 開發環境
```bash
cd c:\Dev\travel-app
npm install  # 首次安裝依賴
npm run dev  # 啟動開發伺服器
```

應用將在 http://localhost:5174/travel-app/ 運行

### 生產環境
```bash
npm run build  # 構建優化版本
npm run preview  # 預覽
```

## 3️⃣ 使用記帳功能

### 進入記帳頁面
1. 打開旅程詳細頁面
2. 點擊導航欄中的 **💰 記帳** 標籤

### 快速新增記帳
```
選擇分類 (快捷鍵) → 填寫金額 → 選擇付款人 → 儲存
```

### 完整流程範例

**情境**：日本旅程第2天，小王在築地買了3人份早餐，花費¥3000

1. 點擊 **💰 記帳** 標籤
2. 點擊 **🍽️ 餐飲** 快捷鍵
3. 填寫表單：
   ```
   項目名稱: 築地早餐
   原始金額: 3000
   幣別: JPY
   匯率: 0.215 (自動填入)
   分類: 餐飲 (已選)
   支付方式: 現金
   消費日期: 2026-01-22 (當日)
   誰付的: 小王
   分擔人員: 小李, 小張
   備註: 3人份早餐
   ```
4. 點擊 **儲存**

**結果**：
- 系統自動計算：¥3000 × 0.215 = NT$645
- 每人應付：NT$645 ÷ 3 = NT$215
- 清算建議中顯示各人應收/應付

## 🔑 關鍵概念

### 支付方式
| 方式 | 場景 | 清算方式 |
|------|------|---------|
| 💵 現金 | 當場付款 | 直接轉帳 |
| 💳 信用卡 | 卡片付款 | 記錄分擔額 |
| 🎫 IC卡 | Suica等 | 後續補付 |

### 分類詳解
| 分類 | 例子 | 通常分帳 |
|------|------|---------|
| 🍽️ 餐飲 | 餐廳、便利店、咖啡 | 平均分 |
| 🚌 交通 | 電車、出租車、機場巴士 | 看情況 |
| 🛏️ 住宿 | 飯店、民宿 | 按房間 |
| 🎫 門票 | 景點門票、遊樂園 | 依人數 |
| 🎁 伴手禮 | 明信片、小禮物 | 各自 |
| 🛍️ 購物 | 衣服、化妝品 | 各自 |
| ✈️ 機票 | 飛機票 | 各自 |
| 📍 其他 | 其他消費 | 具體商量 |

### 清算邏輯
```
總支出 = 所有記帳的台幣合計
平均每人 = 總支出 ÷ (獨立付款人數)

對每筆支出：
  分擔人數 = 1(付款人) + 分擔人員數
  每人應付 = 台幣金額 ÷ 分擔人數

最終計算：
  應收 = 已付 - 應付（正數為應收）
  應付 = 應付 - 已付（正數為應付）
```

## ⚙️ 常用設置

### 推薦匯率設定
```
日本(JPY): 1¥ = 0.215 TWD (每天更新)
美國(USD): 1$ = 32 TWD
台灣(TWD): 1 TWD = 1 TWD
```

### 人員命名建議
```
✅ 推薦: 小王, 小李, 小張
❌ 避免: 王, 李, 張 (易混淆)
❌ 避免: 王某某, 李某某 (名字太長)
```

## 🔍 故障排查

| 問題 | 原因 | 解決方案 |
|------|------|---------|
| 記帳按鈕不工作 | SQL未執行 | 執行 SQL_SETUP_EXPENSES.sql |
| 記帳無法保存 | 未填寫必填項 | 檢查項目名、金額、付款人 |
| 清算數字不對 | 分擔人名字不一致 | 確保拼寫完全相同 |
| 看不到台幣金額 | 匯率為0 | 設置正確的匯率 |
| 無法編輯記帳 | 不是該記帳的所有者 | 檢查user_id是否匹配 |

## 📱 移動設備使用

應用已優化於移動設備：

```
✓ 表單自下而上滑出
✓ 大按鈕易於點擊
✓ 響應式佈局
✓ 觸屏友好操作
```

在手機上只需：
1. 訪問應用URL
2. 點擊💰記帳標籤
3. 點擊分類快捷鍵
4. 填寫表單
5. 儲存

## 📊 查看清算建議

### 位置
頁面底部「🧮 清算建議」區段

### 理解結果
```
小王: 已付 2000 應付 1500 → 應收 500
     表示小王應該收到500元

小李: 已付 1000 應付 1000 → 平衡 ✓
     表示小李已付清

小張: 已付 500 應付 1500 → 應付 1000
     表示小張還應該給別人1000元
```

## 🎯 最佳實踐

### 即時記帳
```
✓ 消費後立即記帳
✓ 同步填寫分擔人
✓ 附上簡要備註
```

### 定期檢查
```
✓ 每天結束時檢查當日記帳
✓ 核實清算建議是否合理
✓ 糾正錯誤記帳
```

### 清算時機
```
✓ 旅程中期：確保資料無誤
✓ 旅程結束：完成最終結算
✓ 回家後：保留記錄備查
```

## 💡 進階技巧

### 多人分擔
```
輸入: 小李, 小張, 小王
結果: 4人(包括付款人)平均分擔
```

### 批量編輯
```
1. 點擊要修改的記帳
2. 改動數據
3. 儲存
4. 重複步驟 1-3
```

### 匯率更新
```
1. 每筆新記帳都能設置不同匯率
2. 編輯舊記帳時可調整匯率
3. 匯率自動用於台幣計算
```

## 📞 需要幫助？

### 檢查清單
- [ ] 已執行 SQL_SETUP_EXPENSES.sql？
- [ ] 已登入應用？
- [ ] 已填寫所有必填項？
- [ ] 分擔人名字拼寫一致？
- [ ] 匯率設置正確？

### 查看文檔
- `EXPENSE_FEATURE.md` - 完整功能說明
- `EXPENSE_GUIDE.md` - 詳細使用指南
- `IMPLEMENTATION_SUMMARY.md` - 技術實現細節

---

**準備好了嗎？讓我們開始記帳吧！** 💰✨
